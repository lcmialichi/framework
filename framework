<?php

use App\Console\Console;
use App\Helpers\ClassLoader;
use App\Console\Commands\Command;
use App\Exception\CommandHandler;
use App\Console\Execution\CommandEmiter;
use App\Contracts\ExceptionHandlerInterface;

require __DIR__ . "/vendor/autoload.php";

$app = require __DIR__ . "/boot/Application.php";

$app->bind(
    ExceptionHandlerInterface::class,
    fn($app) => $app->make(CommandHandler::class)
);

// dd(resolve(CommandEmiter::class));
$console = new Console();
$command = $app->make(Command::class, [
    "loader" => new ClassLoader(
        "App\\Console\\Commands",
        true
    )
]);

$argument = $console->argument(1);
if (empty($argument)) {
    $command->outputList();
    exit;
}

$command->run($argument);